<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>à¸„à¸³à¹€à¸—à¸¨à¸™à¸²à¸¥à¹ˆà¸²à¸ªà¸¸à¸”</title>
<link rel="stylesheet" href="style.css">
</head>
<body>

<h1>à¸„à¸³à¹€à¸—à¸¨à¸™à¸²à¸¥à¹ˆà¸²à¸ªà¸¸à¸”</h1>
<div id="latest" class="grid"></div>
<a class="page-link" href="sermons.html">ðŸ“š à¸”à¸¹à¸„à¸³à¹€à¸—à¸¨à¸™à¸²à¸¢à¹‰à¸­à¸™à¸«à¸¥à¸±à¸‡à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”</a>

<script src="data.js"></script>
<script>
function formatDate(value) {
  if (typeof value === "string" && value.startsWith("Date")) {
    const parts = value.match(/\d+/g);
    const d = new Date(parts[0], parts[1], parts[2]);
    return d.toLocaleDateString("th-TH", { year:"numeric", month:"long", day:"numeric" });
  }
  if (typeof value === "number") {
    const d = new Date(Math.round((value - 25569) * 86400 * 1000));
    return d.toLocaleDateString("th-TH", { year:"numeric", month:"long", day:"numeric" });
  }
  return value || "";
}

function getYouTubeID(url) {
  if (!url) return null;
  const patterns = [
    /youtu\.be\/([^?&]+)/,
    /watch\?v=([^?&]+)/,
    /\/live\/([^?&]+)/,
    /embed\/([^?&]+)/
  ];
  for (const p of patterns) {
    const m = url.match(p);
    if (m && m[1]) return m[1];
  }
  return null;
}

function renderPlayer(el, id) {
  el.innerHTML = `<iframe src="https://www.youtube.com/embed/${id}?autoplay=1"
    allow="autoplay; encrypted-media" allowfullscreen></iframe>`;
}

loadSermons().then(data => {
  const box = document.getElementById("latest");
  data.slice(0,3).forEach((s,i) => {
    const id = getYouTubeID(s.youtube);
    const thumb = id ? `https://img.youtube.com/vi/${id}/hqdefault.jpg` : "";

    box.innerHTML += `
      <div class="card ${i===0?'featured':''}">
        <h3>${s.title}</h3>
        <p>${formatDate(s.date)} â€¢ ${s.preacher}</p>

        ${id ? `
        <div class="video-thumb" onclick="renderPlayer(this,'${id}')">
          <img src="${thumb}" alt="">
          <div class="play">â–¶</div>
        </div>` : `
        <div class="video-thumb no-video">
          <div class="play">à¹„à¸¡à¹ˆà¸¡à¸µà¸§à¸´à¸”à¸µà¹‚à¸­</div>
        </div>`}

        <a href="sermon.html?title=${encodeURIComponent(s.title)}&date=${encodeURIComponent(formatDate(s.date))}&preacher=${encodeURIComponent(s.preacher)}&doc=${encodeURIComponent(s.doc)}">
          ðŸ“– à¸­à¹ˆà¸²à¸™à¸„à¸³à¹€à¸—à¸¨à¸™à¸²
        </a>
      </div>`;
  });
});
</script>

</body>
</html>
